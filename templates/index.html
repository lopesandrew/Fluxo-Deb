<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Deb√™ntures CDI+</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <h1>Calculadora de Deb√™ntures CDI+</h1>
                <p class="company-name">BCP Securities</p>
            </div>
            <p class="subtitle">Padr√£o B3/ANBIMA - Base 252 dias √∫teis</p>
        </header>

        <!-- Formul√°rio -->
        <div class="card" id="form-card">
            <h2>Dados da Deb√™nture</h2>
            <form id="debenture-form">
                <!-- Datas -->
                <div class="form-section">
                    <h3>üìÖ Prazos</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="emission_date">Data de Emiss√£o *</label>
                            <input type="date" id="emission_date" name="emission_date" required>
                        </div>
                        <div class="form-group">
                            <label for="maturity_date">Data de Vencimento *</label>
                            <input type="date" id="maturity_date" name="maturity_date" required>
                        </div>
                    </div>
                </div>

                <!-- Valor -->
                <div class="form-section">
                    <h3>üí∞ Valor</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vne">Valor Nominal de Emiss√£o (R$) *</label>
                            <input type="number" id="vne" name="vne" value="1000.00" step="0.01" min="0.01" required>
                            <small>Padr√£o ANBIMA: R$ 1.000,00</small>
                        </div>
                    </div>
                </div>

                <!-- Remunera√ß√£o -->
                <div class="form-section">
                    <h3>üìä Remunera√ß√£o</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="use_curve" name="use_curve">
                                Usar Curva DI Futura ANBIMA
                            </label>
                            <small>Se desmarcado, informe taxa CDI fixa abaixo</small>
                        </div>
                    </div>
                    <div class="form-row" id="cdi-rate-row">
                        <div class="form-group">
                            <label for="cdi_rate">Taxa CDI Projetada (% a.a.)</label>
                            <input type="number" id="cdi_rate" name="cdi_rate" value="10.65" step="0.01" min="0">
                            <small>Exemplo: 10.65 para 10,65% ao ano</small>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="spread">Spread sobre CDI (% a.a.) *</label>
                            <input type="number" id="spread" name="spread" value="2.50" step="0.01" min="0" required>
                            <small>Exemplo: 2.50 para CDI + 2,50%</small>
                        </div>
                    </div>
                </div>

                <!-- Estrutura -->
                <div class="form-section">
                    <h3>üîß Estrutura</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="interest_frequency">Periodicidade dos Juros *</label>
                            <select id="interest_frequency" name="interest_frequency" required>
                                <option value="mensal">Mensal</option>
                                <option value="trimestral">Trimestral</option>
                                <option value="semestral" selected>Semestral</option>
                                <option value="anual">Anual</option>
                                <option value="bullet">Bullet (no vencimento)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amort_type">Sistema de Amortiza√ß√£o *</label>
                            <select id="amort_type" name="amort_type" required>
                                <option value="bullet" selected>Bullet (tudo no vencimento)</option>
                                <option value="sac">SAC (Sistema de Amortiza√ß√£o Constante)</option>
                                <option value="price">PRICE (Sistema Franc√™s)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="grace_period_months">Car√™ncia do Principal (meses)</label>
                            <input type="number" id="grace_period_months" name="grace_period_months" value="0" min="0" step="1">
                            <small>Per√≠odo sem amortiza√ß√£o do principal</small>
                        </div>
                    </div>
                </div>

                <!-- Bot√µes -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="calc-btn">
                        üßÆ Calcular Fluxo
                    </button>
                    <button type="reset" class="btn btn-secondary">
                        üîÑ Limpar
                    </button>
                </div>
            </form>

            <!-- Loading -->
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Calculando fluxo de caixa...</p>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="error-message" style="display: none;"></div>
        </div>

        <!-- Resultados -->
        <div id="results" style="display: none;">
            <!-- Resumo dos Inputs -->
            <div class="card">
                <h2>üìã Dados da Opera√ß√£o</h2>
                <div class="input-summary" id="input-summary"></div>
            </div>

            <!-- M√©tricas -->
            <div class="card">
                <h2>üìä M√©tricas Financeiras</h2>
                <div class="metrics-grid" id="metrics-grid"></div>
            </div>

            <!-- Fluxo de Caixa -->
            <div class="card">
                <h2>üíµ Fluxo de Pagamentos</h2>
                <div class="table-container">
                    <table id="cash-flow-table">
                        <thead>
                            <tr>
                                <th>Evento</th>
                                <th>Data</th>
                                <th>DU</th>
                                <th>DC</th>
                                <th>Saldo Devedor (R$)</th>
                                <th>Juros (R$)</th>
                                <th>Amortiza√ß√£o (R$)</th>
                                <th>PMT (R$)</th>
                            </tr>
                        </thead>
                        <tbody id="cash-flow-body"></tbody>
                        <tfoot id="cash-flow-footer"></tfoot>
                    </table>
                </div>
            </div>

            <!-- Gr√°fico -->
            <div class="card">
                <h2>üìà Visualiza√ß√£o</h2>
                <canvas id="cash-flow-chart"></canvas>
            </div>

            <!-- A√ß√µes -->
            <div class="card">
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="window.print()">
                        üñ®Ô∏è Imprimir
                    </button>
                    <button class="btn btn-secondary" onclick="location.reload()">
                        üîô Nova Simula√ß√£o
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p><strong>BCP Securities</strong> | Calculadora de Deb√™ntures CDI+</p>
        <p style="font-size: 0.85em; margin-top: 5px;">Padr√£o B3/ANBIMA - Base 252 dias √∫teis</p>
    </footer>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
